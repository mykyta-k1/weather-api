# Weather Forecast API

REST API сервіс для отримання прогнозу погоди на основі OpenWeatherMap API. Застосунок надає агреговані погодні дані на п'ять днів для вказаного міста з усередненими показниками температури, вологості, швидкості вітру та іншими метеорологічними параметрами.

## Технологічний стек

- **Java 17+** — основна мова програмування
- **Spring Boot 3.x** — фреймворк для побудови застосунку
- **Spring Web** — для створення RESTful API
- **RestClient** — для інтеграції з OpenWeatherMap API
- **Lombok** — для зменшення boilerplate коду
- **Jackson** — для обробки JSON даних
- **SLF4J/Logback** — для логування

## Функціональні можливості

Застосунок забезпечує наступний функціонал:

- Отримання прогнозу погоди на п'ять днів для будь-якого міста
- Автоматична агрегація даних з тригодинних інтервалів у денні картки
- Обчислення середніх значень для всіх метеорологічних показників
- Визначення найхарактернішого стану погоди для кожного дня
- Централізована обробка помилок з інформативними повідомленнями
- Підтримка CORS для інтеграції з фронтенд застосунками

## API Endpoints

### Отримання прогнозу погоди

**GET** `/api/v1/forecasts/{cityName}`

Повертає список прогнозів погоди на п'ять днів для вказаного міста.

**Параметри шляху:**
- `cityName` — назва міста (наприклад, "Kyiv", "London", "New York")

**Приклад запиту:**
```http
GET /api/v1/forecasts/Kyiv
```

**Приклад успішної відповіді (200 OK):**
```json
[
  {
    "date": "2024-12-15",
    "temperature": 2.45,
    "feelsLike": -1.23,
    "minTemperature": 0.87,
    "maxTemperature": 4.12,
    "pressure": 1015.34,
    "visibility": 9500.0,
    "humidity": 78.5,
    "weather": {
      "main": "Clouds",
      "description": "broken clouds",
      "icon": "04d"
    },
    "wind": {
      "speed": 4.32,
      "gust": 7.89,
      "deg": 245.0
    },
    "city": {
      "name": "Kyiv",
      "country": "UA",
      "population": 2797553,
      "timezone": "2024-12-15T12:00:00",
      "sunset": "2024-12-15T16:30:00",
      "sunrise": "2024-12-15T07:45:00"
    }
  }
]
```

**Коди відповідей:**
- `200 OK` — прогноз успішно знайдено
- `404 Not Found` — місто не знайдено
- `503 Service Unavailable` — проблеми з доступом до зовнішнього API

## Архітектура застосунку

Проєкт організовано за трирівневою архітектурою:

**Controller Layer** — обробка HTTP запитів та формування відповідей. ForecastController приймає запити від клієнтів та делегує бізнес-логіку сервісному шару.

**Service Layer** — бізнес-логіка застосунку. ForecastServiceImpl виконує запити до OpenWeatherMap API, обробляє отримані дані, групує прогнози за днями та обчислює середні значення метеорологічних показників.

**Model Layer** — об'єктна модель даних. Forecast представляє прогноз на один день, Weather містить інформацію про стан погоди, Wind зберігає дані про вітер, City містить інформацію про місто.

**Exception Handling** — централізована обробка помилок через ExceptionControllerAdvice, що забезпечує уніфіковані відповіді при виникненні винятків.

## Принцип роботи агрегації даних

Застосунок отримує детальний прогноз від OpenWeatherMap API з інтервалом у три години на п'ять днів (приблизно 40 записів). Сервіс ForecastServiceImpl виконує наступну обробку:

**Групування за днями** — всі тригодинні прогнози групуються за календарними днями на основі timestamp даних.

**Обчислення середніх значень** — для кожного дня розраховуються середні показники температури, відчуваної температури, тиску, вологості, видимості та характеристик вітру шляхом сумування всіх значень за день та ділення на кількість тригодинних періодів.

**Визначення домінуючої погоди** — система аналізує всі стани погоди протягом дня та визначає найбільш характерний стан, який зустрічався найчастіше. Це дозволяє надати користувачу найрепрезентативніший опис погодних умов для кожного дня.

**Округлення значень** — всі числові показники округлюються до двох знаків після коми для зручності читання та уніфікації формату відповіді.

## Налаштування та запуск

### Вимоги

- Java 17 або новіша версія
- Maven 3.6+ або Gradle
- API ключ від OpenWeatherMap (отримати на https://openweathermap.org/api)

### Змінні оточення

Створіть файл `.env` або встановіть змінні оточення:

```properties
BASE_API_URL=https://api.openweathermap.org
API_KEY=your_openweathermap_api_key
ALLOWED_ORIGIN=http://localhost:3000
```

### Конфігурація application.yml

```yaml
api:
  base-url: ${BASE_API_URL}
  key: ${API_KEY}
  origin: ${ALLOWED_ORIGIN}
```

### Запуск застосунку

**За допомогою Maven:**
```bash
mvn clean install
mvn spring-boot:run
```

**За допомогою Gradle:**
```bash
gradle clean build
gradle bootRun
```

Застосунок буде доступний за адресою: `http://localhost:8080`

### Тестування API

Виконайте тестовий запит за допомогою curl:

```bash
curl http://localhost:8080/api/v1/forecasts/Kyiv
```

Або відкрийте у браузері:
```
http://localhost:8080/api/v1/forecasts/London
```

## Обробка помилок

Застосунок повертає структуровані відповіді при виникненні помилок:

**404 Not Found** — коли вказане місто не знайдено в базі OpenWeatherMap:
```json
{
  "timestamp": "2024-12-15T10:30:00",
  "status": 404,
  "error": "Not Found",
  "message": "Місто не знайдено: InvalidCity",
  "path": "/api/v1/forecasts/InvalidCity"
}
```

**503 Service Unavailable** — при проблемах з доступом до зовнішнього API або мережевих помилках.

## CORS конфігурація

Застосунок налаштовано для підтримки Cross-Origin запитів від фронтенд застосунків. Дозволений origin налаштовується через змінну оточення `ALLOWED_ORIGIN`.

## Логування

Застосунок використовує SLF4J з Logback для логування важливих подій та помилок. Логи включають інформацію про:

- Помилки мапінгу JSON даних від зовнішнього API
- Проблеми з обробкою окремих полів прогнозу
- Мережеві помилки та винятки при взаємодії з OpenWeatherMap

Рівень логування можна налаштувати у файлі `application.yml`:

```yaml
logging:
  level:
    com.weather.api: DEBUG
```

## Розширення функціоналу

Застосунок можна розширити наступними можливостями:

- Підтримка різних систем вимірювання (метрична/імперська) через параметр запиту
- Кешування результатів для зменшення навантаження на зовнішнє API
- Додавання прогнозів на більший період часу
- Інтеграція з іншими погодними API для порівняння даних
- Збереження історії прогнозів у базу даних
- Підтримка геолокації для автоматичного визначення міста

## Ліцензія

Цей проєкт створено в освітніх цілях.

## Автори

Розроблено як практична робота з курсу веб-розробки.
